<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Machine Ranked</title>
  <link
      rel="icon"
      href="https://cdn.glitch.global/26392432-bee1-4edf-8555-805ec021d39d/machine.png?v=1736272213189"
      type="image/png"
    />
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 400px;
            padding: 20px;
            background-color: #1f1f1f;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 15px;
            color: #ffcc00;
        }

        p {
            margin: 10px 0;
            font-size: 16px;
        }

        .stats-box {
            background-color: #292929;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: inset 2px 2px 5px #111, inset -2px -2px 5px #333;
        }

        .stats-box p {
            margin: 5px 0;
            font-size: 14px;
        }

        .button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            border: none;
            background-color: #333;
            color: #ffffff;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s ease, background-color 0.3s ease;
        }

        .button:hover {
            background-color: #444;
            transform: scale(1.02);
          cursor: pointer;
        }

        img {
            max-width: 80px;
            margin: 10px auto;
            display: block;
            border-radius: 8px;
        }

        .slot-machine {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin: 20px 0;
        }

        .slot {
            width: 60px;
            height: 60px;
            border: 2px solid #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            background-color: #292929;
            color: #ffcc00;
            border-radius: 8px;
            box-shadow: inset 2px 2px 5px #111, inset -2px -2px 5px #333;
        }

        @media (max-width: 600px) {
            .slot-machine {
                flex-direction: column;
                align-items: center;
            }
        }
      .hidden {
            display: none;
        }
      .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin: 2px;
        }
        .dot.active {
            background-color: green;
        }
        .dot.inactive {
            background-color: grey;
        }
      .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #292929;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
        z-index: 1000;
        text-align: center;
        width: 300px;
    }

    .popup-title {
        font-size: 18px;
        margin-bottom: 10px;
        color: #ffcc00;
    }

    .title-list {
        max-height: 200px;
        overflow-y: auto;
        margin: 10px 0;
    }

    .title-item {
        padding: 10px;
        background-color: #1f1f1f;
        border-radius: 8px;
        margin: 5px 0;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s ease;
    }

    .title-item:hover {
        background-color: #333;
    }

    .title-item span {
        font-size: 14px;
    }

    .title-item .glow {
        text-shadow: 0 0 5px #ffcc00, 0 0 10px #ffcc00;
    }

    .close-popup {
        margin-top: 10px;
        background-color: #ff0000;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        cursor: pointer;
    }

    .close-popup:hover {
        background-color: #cc0000;
    }
      .loading-dots {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 10px;
}

.loading-dot {
    width: 10px;
    height: 10px;
    margin: 0 5px;
    background-color: white;
    border-radius: 50%;
    animation: grow-shrink 1.2s infinite ease-in-out;
}

.loading-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.loading-dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes grow-shrink {
    0%, 100% {
        transform: scale(1);
        opacity: 0.5;
    }
    50% {
        transform: scale(1.5);
        opacity: 1;
    }
}
#title-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #333;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #000;
    z-index: 1000;
    width: 80%;
    max-width: 400px;
    color: white;
  }

  #titles-list {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 10px;
  }

  #titles-list div {
    padding: 10px;
    margin: 5px 0;
    background: #444;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
  }

  #titles-list div:hover {
    background: #555;
  }

  .hidden {
    display: none;
  }

  #title-popup,
  #notification-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #333;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #000;
    z-index: 1000;
    width: 80%;
    max-width: 400px;
    color: white;
  }

  #titles-list {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 10px;
  }

  #titles-list div {
    padding: 10px;
    margin: 5px 0;
    background: #444;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
  }

  #titles-list div:hover {
    background: #555;
  }

  #close-title-popup,
  #ok-button,
  #equip-now-button {
    margin: 5px;
  }

  #notification-popup h2 {
    color: #00ff00;
  }

  #notification-popup p {
    font-size: 1.2em;
  }
      .glowing-title {
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.7),
      0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.5);
  }
      .button-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}
  /* Style popups */
.popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #292929;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
    z-index: 1000;
    text-align: center;
    width: 300px;
    color: white;
}

/* Tab Styling */
.tab-container {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    justify-content: center;
}

.tab-button {
    background: #444;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 5px;
    color: white;
}

.tab-button.active {
    background: #ffcc00;
    color: black;
}

/* Hide tab content by default */
.tab-content {
    display: none;
}

.tab-content:not(.hidden) {
    display: block;
}

/* Buttons */
.close-button {
    margin-top: 10px;
    background: red;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 5px;
}
    </style>
</head>
<body>

<div id="menu-screen" class="container">
    <h1>Slot Machine Ranked</h1>
    <p><span id="username-display">Player</span></p>
    <div id="title-display"></div>
    <button class="button" onclick="editUsername()">Edit Username</button>

    <div class="stats-box">
        <p>Wins: <span id="wins">0</span></p>
        <p>Losses: <span id="losses">0</span></p>
        <p>Win%: <span id="winrate">0%</span></p>
        <p>Peak Rank: <span id="peak-rank">Unranked</span></p>
        <p>Peak MMR: <span id="peak-mmr">0</span></p>
        <p>VCoins: <span id="player-coins">0</span></p>
    </div>

    <img id="rank-image" src="images/unranked.png" alt="Rank">
    <p><span id="current-rank">Unranked</span></p>
    <p>MMR: <span id="current-mmr">1000</span></p>
    <button class="button" onclick="startQueue()">Queue</button>

    <div class="button-container">
       <button class="button" onclick="openPopup('shop-popup')">Shop</button>
        <button class="button" onclick="openPopup('inventory-popup')">Inventory</button>
    </div>
</div>

<div id="queue-screen" class="container hidden">
    <h1>Queueing...</h1>
    <p>Time Elapsed: <span id="queue-time">0</span>s</p>
    <p>Estimated Time: 10s</p>
    <div class="loading-dots">
        <span class="loading-dot"></span>
        <span class="loading-dot"></span>
        <span class="loading-dot"></span>
    </div>
    <button class="button" onclick="cancelQueue()">Cancel</button>
</div>

<div id="match-screen" class="container hidden">
    <h1>Match</h1>
    <div id="countdown">5</div>
    <div class="game-info">
        <div>
            <h3>You</h3>
            <p><span id="player-username">Player</span></p>
            <p><span id="player-rank">Unranked</span> [<span id="player-mmr">0</span>]</p>
            <div class="slot-machine">
                <div class="slot" id="player-slot-1">?</div>
                <div class="slot" id="player-slot-2">?</div>
                <div class="slot" id="player-slot-3">?</div>
            </div>
            <button class="button" onclick="spin('player')">Spin</button>
            <div id="player-dots">
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
            </div>
        </div>
        <div>
            <h3>Opponent</h3>
            <p><span id="ai-username"></span></p>
            <p><span id="ai-rank">Unranked</span> [<span id="ai-mmr">0</span>]</p>
            <div class="slot-machine">
                <div class="slot" id="ai-slot-1">?</div>
                <div class="slot" id="ai-slot-2">?</div>
                <div class="slot" id="ai-slot-3">?</div>
            </div>
            <div id="ai-dots">
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
                <span class="dot inactive"></span>
            </div>
        </div>
    </div>
</div>

<div id="end-screen" class="container hidden">
    <h1>Game Over</h1>
    <p>Result: <span id="result"></span></p>
    <p id="player-jackpots"></p>
    <p id="ai-jackpots"></p>
    <p><span id="old-mmr"></span>, <span id="new-mmr"></span></p>
    <p id="mmr-change"></p>
    <p id="player-coins"></p>
    <button class="button" onclick="goToMenu()">Back to Menu</button>
</div>

<!-- Title Popup -->
<div id="title-popup" class="hidden">
    <h2>Your Titles</h2>
    <div id="titles-list"></div>
    <button id="close-title-popup">Close</button>
</div>

<!-- Notification Popup -->
<div id="notification-popup" class="hidden">
    <h2>NEW ITEM UNLOCKED:</h2>
    <p id="new-title"></p>
    <button id="ok-button">OK</button>
    <button id="equip-now-button">Equip Now</button>
</div>
<!-- Shop Popup -->
<div id="shop-popup" class="popup hidden">
    <div class="popup-content">
        <h2>Shop</h2>
        <div class="tab-container">
            <button class="tab-button active" onclick="switchTab('shop', 'hero')">Hero</button>
            <button class="tab-button" onclick="switchTab('shop', 'skin')">Skin</button>
            <button class="tab-button" onclick="switchTab('shop', 'title')">Title</button>
        </div>
        <div id="shop-hero" class="tab-content">
            <p>Placeholder heroes for sale...</p>
        </div>
        <div id="shop-skin" class="tab-content hidden">
            <p>Placeholder skins for sale...</p>
        </div>
        <div id="shop-title" class="tab-content hidden">
            <p>Placeholder titles for sale...</p>
        </div>
        <button class="close-button" onclick="closePopup('shop-popup')">Close</button>
    </div>
</div>

<!-- Inventory Popup -->
<div id="inventory-popup" class="popup hidden">
    <div class="popup-content">
        <h2>Inventory</h2>
        <div class="tab-container">
            <button class="tab-button active" onclick="switchTab('inventory', 'hero')">Hero</button>
            <button class="tab-button" onclick="switchTab('inventory', 'skin')">Skin</button>
            <button class="tab-button" onclick="switchTab('inventory', 'title')">Title</button>
        </div>
        <div id="inventory-hero" class="tab-content">
            <p>Your owned heroes...</p>
            <button class="button">Equip</button>
        </div>
        <div id="inventory-skin" class="tab-content hidden">
            <p>Your owned skins...</p>
            <button class="button">Equip</button>
        </div>
        <div id="inventory-title" class="tab-content hidden">
            <p>Your owned titles...</p>
            <button class="button">Equip</button>
        </div>
        <button class="close-button" onclick="closePopup('inventory-popup')">Close</button>
    </div>
</div>
</body>
</html>



    <script>
const aiNames = [
  // Lower rank names
  "L",
  "kupid",
  "l0st",
  "jayleng",
  "weweewew",
  "RisingPhoinex87",
  "dr.1",
  "prot",
  "hunt",
  "kif",
  "?",
  "rivverott",
  "1x Dark",
  "Moxxy!",
  "ä",
  "شغثغخ",
  "dark!",
  "Vortex",
  "FlickMaster17",
  "r",
  "Skywave!",
  "R3tr0",
  "TurboClash893",
  "Zynk",
  "Null_Force",
  "Orbital",
  "Boosted",
  "GravyTrain",
  "NitroNinja",
  "PixelPlay",
  "PhantomX",
  "Fury",
  "Zero!",
  "Moonlight",
  "QuickTap",
  "v1per",
  "Slugger",
  "MetaDrift",
  "Hydra",
  "Neo!",
  "ShadowDart",
  "SlipStream",
  "F1ick",
  "Karma",
  "Sparkz",
  "Glitch",
  "Dash7",
  "Ignite",
  "Cyclone",
  "Nova",
  "Opt1c",
  "Viral",
  "Stormz",
  "PyroBlast",
  "Bl1tz",
  "Echo",
  "Hover",
  "PulseRider"
];

let playerData = {
    username: "Player",
    title: "None",
    wins: 0,
    losses: 0,
    mmr: 600,
    peakMMR: 600,
    coins: 0,
  inventory: [],
};
let aiData = {
    username: "",
    mmr: 600
};
const items = [
    {name: "Centio", type: "hero", price: 1500, rarity: "common", perks: {1: 35, 2: 10}},
    {name: "20XX", type: "skin", price: 250, rarity: "common", perks: {1: 10, 2: 60}},
];
let queueInterval;
let countdownInterval;
let spinInterval;
let gameActive = false; // Flag to control game state
let spacebarHeld = false; // Flag to track if spacebar is held

const jackpotProbability = 0.29;

document.addEventListener("keydown", (event) => {
    if (event.code === "Space" && !event.repeat && gameActive && !spacebarHeld) {
        spacebarHeld = true;
        spin("player");
        holdSpacebarToSpin();
    }
});
function cancelQueue() {
location.reload();
}
document.addEventListener("keyup", (event) => {
    if (event.code === "Space") {
        spacebarHeld = false;
    }
});

function holdSpacebarToSpin() {
    if (spacebarHeld && gameActive) {
        setTimeout(() => {
            spin("player");
            holdSpacebarToSpin();
        }, 111); // Adjust interval for repeated spins
    }
}
function savePlayerData() {
    localStorage.setItem("playerData", JSON.stringify(playerData));
}

function loadPlayerData() {
    const savedData = localStorage.getItem("playerData");
    if (savedData) {
        playerData = JSON.parse(savedData);
    }
}
function loadShop() {
    console.log("Loading Shop..."); // Debug log
    const shopContainer = document.getElementById("shop-hero");
    
    if (!shopContainer) {
        console.error("Shop container not found!");
        return;
    }
    
    shopContainer.innerHTML = ""; // Clear existing content

    const availableItems = items.filter(item => item.type === "hero");
    console.log("Available Hero Items:", availableItems); // Debug log
    
    if (availableItems.length === 0) {
        shopContainer.innerHTML = "<p>No heroes available for purchase.</p>";
        return;
    }

    availableItems.forEach(item => {
        const itemElement = document.createElement("div");
        itemElement.classList.add("shop-item");
        itemElement.innerHTML = `
            <h3>${item.name}</h3>
            <p>Perks: Click Boost ${item.perks[1]}%, Jackpot Increase ${item.perks[2]}%</p>
            <p class="price">${playerData.inventory.includes(item.name) ? "OWNED" : item.price + " Coins"}</p>
            <button onclick="purchaseItem('${item.name}')" ${playerData.inventory.includes(item.name) ? "disabled" : ""}>
                ${playerData.inventory.includes(item.name) ? "Owned" : "Buy"}
            </button>
        `;
        shopContainer.appendChild(itemElement);
    });
}


function loadInventory() {
    const inventoryContainer = document.getElementById("inventory-hero");
    inventoryContainer.innerHTML = "<p>Your owned heroes...</p>"; // Clear previous items

    if (playerData.inventory.length === 0) {
        inventoryContainer.innerHTML += "<p>No heroes owned.</p>";
        return;
    }

    playerData.inventory.forEach(itemName => {
        const item = items.find(i => i.name === itemName);
        if (item) {
            const itemElement = document.createElement("div");
            itemElement.classList.add("inventory-item");
            itemElement.innerHTML = `
                <h3>${item.name}</h3>
                <p>Perks: Click Boost ${item.perks[1]}%, Jackpot Increase ${item.perks[2]}%</p>
                <button class="button">Equip</button>
            `;
            inventoryContainer.appendChild(itemElement);
        }
    });
}

function purchaseItem(itemName) {
    const item = items.find(i => i.name === itemName);
    if (!item || playerData.inventory.includes(itemName)) return;
    
    if (playerData.coins >= item.price) {
        if (confirm(`Are you sure you want to buy ${item.name} for ${item.price} coins?`)) {
            playerData.coins -= item.price;
            playerData.inventory.push(item.name);
            savePlayerData();
            loadShop();
        }
    } else {
        alert("Not enough coins!");
    }
}

function getDailyShopRotation() {
    const date = new Date();
    const seed = date.getDate() + date.getHours() >= 12 ? 1 : 0;
    return items.filter((_, index) => index % 2 === seed);
}
// Load data on page load
window.onload = () => {
    loadPlayerData();
    updateMenu();
    loadShop();
};
function editUsername() {
    const newUsername = prompt("Enter your username (1-20 characters):", playerData.username);
    if (newUsername && newUsername.length <= 20) {
        playerData.username = newUsername;
        document.getElementById("username-display").textContent = newUsername;
    }
}
// Opens a popup
function openPopup(popupId) {
    document.getElementById(popupId).style.display = "block";
}

// Closes a popup
function closePopup(popupId) {
    document.getElementById(popupId).style.display = "none";
}

// Switches tabs inside Shop or Inventory
function switchTab(section, tab) {
    // Get all tab contents in the section
    let tabs = document.querySelectorAll(`#${section}-popup .tab-content`);
    tabs.forEach(tabContent => tabContent.classList.add('hidden'));

    // Show the selected tab
    document.getElementById(`${section}-${tab}`).classList.remove('hidden');

    // Update active button style
    let buttons = document.querySelectorAll(`#${section}-popup .tab-button`);
    buttons.forEach(button => button.classList.remove('active'));

    document.querySelector(`#${section}-popup .tab-button:nth-child(${tab === 'hero' ? 1 : tab === 'skin' ? 2 : 3})`).classList.add('active');
}
      

function startQueue() {
    document.getElementById("menu-screen").classList.add("hidden");
    document.getElementById("queue-screen").classList.remove("hidden");

    // Change the tab title
    document.title = "SMR | Searching...";

    const currentHour = new Date().getHours();
    let maxQueueTime = 2; // Default max queue time
    let mmrFactor = Math.max(0, (playerData.mmr - 600) / 200); // Increase time by MMR difference above 600

    // Adjust max queue time based on time of day
    if (currentHour >= 0 && currentHour < 6) {
        maxQueueTime = 54; // Longer wait times at night
    } else if (currentHour >= 18 && currentHour < 22) {
        maxQueueTime = 33; // Shorter wait times in the evening
    }

    maxQueueTime = Math.min(30, Math.round(maxQueueTime + mmrFactor * 2)); // Cap max time to 30 seconds
    document.querySelector("#queue-screen p:nth-of-type(2)").textContent = `Estimated Time: ${maxQueueTime}s`;

    // Randomize the actual match start time (±20% of maxQueueTime)
    const actualMatchTime = Math.floor(maxQueueTime * (0.8 + Math.random() * 0.2)); // Between 80% and 120% of maxQueueTime

    let queueTime = 0;
    queueInterval = setInterval(() => {
        queueTime++;
        document.getElementById("queue-time").textContent = queueTime;

        // Match starts at the randomized actual time
        if (queueTime >= actualMatchTime) {
            clearInterval(queueInterval);
            startMatch();
        }
    }, 1000);
}

const titles = [
  {
    "title": "S1 GRAND CHAMPION",
    "color": "red",
    "glow": true,
    "minMMR": null,
    "wlUsers": [""]
  },
  {
    "title": "OG",
    "color": "grey",
    "glow": false,
    "minMMR": null,
    "wlUsers": [""]
  },
]




    function showNotification(title) {
    }

function startMatch() {
    gameActive = false; // Game inactive until countdown ends
    aiData.username = aiNames[Math.floor(Math.random() * aiNames.length)];
    aiData.mmr = playerData.mmr + (Math.random() < 0.5 ? 1 : -1) * Math.floor(Math.random() * 20) + 1;
    document.getElementById("ai-username").textContent = aiData.username;
    document.getElementById("ai-mmr").textContent = aiData.mmr;

    document.getElementById("player-username").textContent = playerData.username;
    document.getElementById("player-mmr").textContent = playerData.mmr;

    // Update ranks
    const playerRank = getRank(playerData.mmr);
const aiRank = getRank(aiData.mmr);
document.getElementById("player-rank").textContent = playerRank;
document.getElementById("ai-rank").textContent = aiRank;

    document.getElementById("queue-screen").classList.add("hidden");
    document.getElementById("match-screen").classList.remove("hidden");

    // Change the tab title and show notification
    document.title = "SMR | Match Found";
    showNotification("Match Found!");
   showDesktopNotification();

    let countdown = 5;
    document.getElementById("countdown").textContent = countdown;
    countdownInterval = setInterval(() => {
        countdown--;
        document.getElementById("countdown").textContent = countdown > 0 ? countdown : "Go!";
        if (countdown <= 0) {
            clearInterval(countdownInterval);
            gameActive = true; // Activate game after countdown ends
            aiAutoSpin();
        }
    }, 1000);
}


function spin(player) {
    if (!gameActive) return; // Prevent spinning outside active game

    const results = Array.from({ length: 3 }, () => Math.random() < jackpotProbability ? "J" : "-");
    const slots = player === "player" ? ["player-slot-1", "player-slot-2", "player-slot-3"] : ["ai-slot-1", "ai-slot-2", "ai-slot-3"];
    slots.forEach((slot, index) => {
        document.getElementById(slot).textContent = results[index];
    });
    const jackpotCount = results.filter(r => r === "J").length;
    if (jackpotCount === 3) {
        updateDots(player);
    }
    if (checkWinCondition()) {
        clearInterval(spinInterval);
        endGame(player === "player");
    }
}

// Add event listener to the spin button
document.getElementById("spin-button").addEventListener("click", () => {
    if (gameActive) {
        spin("player");
    }
});


function getSpinInterval(mmr) {
  if (mmr >= 1400) return 110;
    if (mmr >= 1314) return 130; // S1 GRAND CHAMPION
    if (mmr >= 994) return 170;  // S1 CHAMPION
    if (mmr >= 754) return 190;  // S1 DIAMOND
    if (mmr >= 594) return 200;  // S1 PLATINUM
    if (mmr >= 414) return 250;  // S1 GOLD
    if (mmr >= 231) return 270;  // S1 SILVER
    return 400;                  // S1 BRONZE and below
}

function aiAutoSpin() {
    const spinSpeed = getSpinInterval(aiData.mmr); // Get spin interval based on AI rank
    spinInterval = setInterval(() => {
        spin("ai");
    }, spinSpeed);
}


function updateDots(player) {
    const dots = player === "player" ? "player-dots" : "ai-dots";
    const dotElements = document.getElementById(dots).getElementsByClassName("dot");
    for (let dot of dotElements) {
        if (!dot.classList.contains("active")) {
            dot.classList.remove("inactive");
            dot.classList.add("active");
            break;
        }
    }
}

function checkWinCondition() {
    const playerDots = document.getElementById("player-dots").getElementsByClassName("active").length;
    const aiDots = document.getElementById("ai-dots").getElementsByClassName("active").length;
    return playerDots === 5 || aiDots === 5;
}

function endGame(playerWon) {
    gameActive = false; // Deactivate the game
    document.getElementById("match-screen").classList.add("hidden");
    document.getElementById("end-screen").classList.remove("hidden");

    // Calculate jackpot counts
    const playerJackpots = document.getElementById("player-dots").getElementsByClassName("active").length;
    const aiJackpots = document.getElementById("ai-dots").getElementsByClassName("active").length;

    // Display results
    document.getElementById("result").textContent = playerWon ? "You Won!" : "You Lost!";
    document.getElementById("result").style.color = playerWon ? "green" : "red";

    document.getElementById("player-jackpots").textContent = `Your Points: ${playerJackpots}`;
    document.getElementById("ai-jackpots").textContent = `Opponent's Points: ${aiJackpots}`;

   // Calculate MMR changes
const oldMMR = playerData.mmr;
const mmrChange = Math.floor(Math.random() * (16 - 7 + 1)) + 7; // Random between 650 and 770
playerData.mmr += playerWon ? mmrChange : -mmrChange;
playerData.mmr = Math.max(playerData.mmr, 0);
playerData.peakMMR = Math.max(playerData.peakMMR, playerData.mmr);


    // Update win/loss counters
if (playerWon) {
    playerData.wins += 1;
    playerData.coins += Math.floor(Math.random() * (30 - 15 + 1)) + 15;
} else {
    playerData.losses += 1;
    playerData.coins += Math.floor(Math.random() * (10 - 1 + 1)) + 1;
}


    // Show MMR changes
    const mmrDiff = playerData.mmr - oldMMR;
    const mmrChangeText = mmrDiff > 0 ? `+${mmrDiff}` : `${mmrDiff}`;
    document.getElementById("old-mmr").textContent = `Old MMR: ${oldMMR}`;
    document.getElementById("new-mmr").textContent = `New MMR: ${playerData.mmr}`;
    document.getElementById("mmr-change").textContent = `MMR Change: ${mmrChangeText}`;
  document.getElementById("player-coins").textContent = `VCoins: ${playerData.coins}`; // Update coins display

    savePlayerData(); // Save after game ends
}



if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission().then(permission => {
        if (permission === "granted") {
            console.log("Notification permission granted.");
        } else {
            console.log("Notification permission denied.");
        }
    });
}

function showDesktopNotification() {
    if ("Notification" in window && Notification.permission === "granted") {
        const notification = new Notification("Match Found!", {
            body: "A match has been found. Get ready to play!",
            icon: "images/match-icon.png", // Replace with your own icon path
        });

        notification.onclick = () => {
            // Bring the tab to focus when notification is clicked
            window.focus();
        };
    } else if ("Notification" in window && Notification.permission !== "denied") {
        // Ask for permission again if it was not denied previously
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                showDesktopNotification();
            }
        });
    }
}

function goToMenu() {
    location.reload(); // Refresh the page to return to the menu
}
function getRankImage(rank) {
    // Remove division info if present (e.g., "Gold III - Div 2" → "Gold III")
    const baseRank = rank.split(" - ")[0];

    const rankImages = {
        "Bronze I": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/939597fb-c29f-4607-9a76-9a6c5f1edf48.image.png?v=1724334781837",
        "Bronze II": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/9965effe-4989-4504-9200-7f04b6b665a2.image.png?v=1724334793116",
        "Bronze III": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/a274e890-4257-4cd9-a02a-56bc80be47d3.image.png?v=1724334816902",
        "Silver I": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/28b40287-5562-45ab-a236-5647e96f1d48.image.png?v=1724334852235",
        "Silver II": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/6caddf21-bee3-46c3-9d27-05823806cb67.image.png?v=1724334861872",
        "Silver III": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/faa8edc7-b482-4cc4-b5b0-ceed84627079.image.png?v=1724334871163",
        "Gold I": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/df499a57-8fc0-4524-bdd0-2fae76ec9301.image.png?v=1724334902060",
        "Gold II": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/a0dedb5b-6bc3-4322-afbb-77cc07184fec.image.png?v=1724334909730",
        "Gold III": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/d3a3b2fc-6fcf-4bdc-85cc-8da4f40b2993.image.png?v=1724334914955",
        "Platinum I": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/2f23a5f7-efe3-45ee-9cb8-acd533b0d6c4.image.png?v=1724335263302",
        "Platinum II": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/3103ab33-c432-43ff-93c3-69a08d1ca602.image.png?v=1724335271866",
        "Platinum III": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/c0fa94d0-d195-42d1-92f1-cb082976bdff.image.png?v=1724335280781",
        "Diamond I": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/db671aad-2dd6-4328-897f-3f259be82fc5.image.png?v=1724335489836",
        "Diamond II": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/76c9b43e-d0f6-4b05-9f32-7243d522c5f1.image.png?v=1724335504082",
        "Diamond III": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/07082c63-cce6-4ff1-bff3-c3fceedf2e54.image.png?v=1724335508559",
        "Champion I": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/a10c88af-e70d-4891-99e7-57abf90002d5.image.png?v=1724335525065",
        "Champion II": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/3d397ae6-e026-45af-b4e3-180318bd415a.image.png?v=1724335551068",
        "Champion III": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/c28f3b1a-1396-4f24-aec7-f289695e5695.image.png?v=1724335556235",
        "Grand Champion I": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/90ecba8a-55f9-457c-8834-2ec4ee1c97fe.image.png?v=1724335571459",
        "Grand Champion II": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/a90fa27e-2330-45d1-8b74-377fb4028842.image.png?v=1724335635668",
        "Grand Champion III": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/30d7ef7b-605e-4830-aa4d-153e5f77d67b.image.png?v=1724335639506",
        "Superslot Legend": "https://cdn.glitch.global/c16ac13c-9db1-4fbb-a599-4c729f45d485/21405196-dbc9-4527-91e7-9a41abc6a698.image.png?v=1724335671471",
    };

    return rankImages[baseRank] || rankImages["Unranked"];
}


function updateMenu() {
    document.getElementById("username-display").textContent = playerData.username;
  
    document.getElementById("wins").textContent = playerData.wins;
    document.getElementById("losses").textContent = playerData.losses;
    const totalGames = playerData.wins + playerData.losses;
    const winRate = totalGames > 0 ? ((playerData.wins / totalGames) * 100).toFixed(1) : 0;
    document.getElementById("winrate").textContent = `${winRate}%`;
    document.getElementById("peak-mmr").textContent = playerData.peakMMR;
  document.getElementById("peak-rank").textContent = getRank(playerData.peakMMR);
    const rank = getRank(playerData.mmr);
    document.getElementById("current-rank").textContent = rank;
    document.getElementById("current-mmr").textContent = playerData.mmr;
    document.getElementById("rank-image").src = getRankImage(rank);
    document.getElementById("player-coins").textContent = playerData.coins;

    savePlayerData(); // Save data whenever menu is updated
}
function getRank(mmr) {
    const ranks = [
        { name: "Bronze I", min: 0, max: 173 },
        { name: "Bronze II", min: 174, max: 233 },
        { name: "Bronze III", min: 234, max: 293 },
        { name: "Silver I", min: 294, max: 354 },
        { name: "Silver II", min: 355, max: 414 },
        { name: "Silver III", min: 415, max: 474 },
        { name: "Gold I", min: 475, max: 534 },
        { name: "Gold II", min: 546, max: 594 },
        { name: "Gold III", min: 595, max: 654 },
        { name: "Platinum I", min: 655, max: 714 },
        { name: "Platinum II", min: 715, max: 763 },
        { name: "Platinum III", min: 764, max: 834 },
        { name: "Diamond I", min: 835, max: 892 },
        { name: "Diamond II", min: 893, max: 981 },
        { name: "Diamond III", min: 995, max: 1074 },
        { name: "Champion I", min: 1075, max: 1185 },
        { name: "Champion II", min: 1186, max: 1299 },
        { name: "Champion III", min: 1300, max: 1402 },
        { name: "Grand Champion I", min: 1403, max: 1574 },
        { name: "Grand Champion II", min: 1575, max: 1699 },
        { name: "Grand Champion III", min: 1708, max: 1864 },
        { name: "SuperSlot Legend", min: 1864, max: 9999 }
    ];
  // Find the rank based on MMR
    for (const rank of ranks) {
        if (mmr >= rank.min && mmr <= rank.max) {
            if (rank.name === "SuperSlot Legend") {
                return rank.name; // No divisions for this rank
            }
            // Calculate division (5 divisions)
            const divisionSize = Math.floor((rank.max - rank.min + 1) / 5);
            const division = Math.min(5, Math.floor((mmr - rank.min) / divisionSize) + 1);
            return `${rank.name} - Div ${division}`;
        }
    }

    return "Unranked";
}


updateMenu();

    </script>
